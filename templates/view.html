{% extends "base.html" %}
{% block content %}

  <h2 class="mb-4">{{ title }}</h2>

  <!-- Search & Filter Bar -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" action="/view" class="row g-3">
        <div class="col-md-5">
          <input type="text" class="form-control" name="q" placeholder="Search part number, name, or description..." value="{{ request.args.get('q', '') }}">
        </div>
        <div class="col-md-4">
          <select class="form-select" name="tag">
            <option value="">Filter by Tag</option>
            <option value="generator" {% if request.args.get('tag') == 'generator' %}selected{% endif %}>Generator</option>
            <option value="transfer switch" {% if request.args.get('tag') == 'transfer switch' %}selected{% endif %}>Transfer Switch</option>
            <option value="other" {% if request.args.get('tag') == 'other' %}selected{% endif %}>Other</option>
          </select>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary w-100">Search / Filter</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Parts Table -->
  {% if parts %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Part #</th>
            <th>Name</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Tag</th>
            <th>Description</th>
            <th class="table-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for pn, item in parts.items() %}
          <tr>
            <td>{{ pn }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>${{ "%.2f"|format(item.price) }}</td>
            <td>{{ item.tag|capitalize or 'Other' }}</td>
            <td>{{ item.description }}</td>
            <td class="table-actions">
  <a href="{{ url_for('edit_part', pn=pn) }}" 
     class="btn btn-sm btn-primary me-2">
    <i class="bi bi-pencil"></i> Edit
  </a>
  <form action="{{ url_for('delete_part', pn=pn) }}" method="post" style="display:inline;">
    <button type="submit" 
            class="btn btn-sm btn-danger"
            onclick="return confirm('Delete {{ item.name }} ({{ pn }}) permanently?');">
      <i class="bi bi-trash"></i> Delete
    </button>
  </form>
</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">
      No parts match the current filters/search.
    </div>
  {% endif %}

{% endblock %}